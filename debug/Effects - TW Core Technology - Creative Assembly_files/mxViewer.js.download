var gOpenCommentsFn=null;function gOpenCommentsFunc(){if(gOpenCommentsFn!=null){gOpenCommentsFn()}}function mxAddSpinner(a,c){var b=document.createElement("div");b.style.cssText=((c)?"position:absolute;top:50%;left:50%;margin-left:-20px;margin-top:-20px;":"position:relative;")+"width:40px;height:40px;";a.appendChild(b);new Spinner({lines:12,length:7,width:3,radius:6,rotate:0,color:"#000",speed:2,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:999}).spin(b);return b}function createViewer(f,c){if(f==null){return}$deferred=$.Deferred();var r=f.parentNode;if(r!=null&&r.previousSibling!=null&&r.getAttribute("data-macro-name")=="drawio"&&r.previousSibling.nodeName=="P"&&(r.previousSibling.childNodes.length==0||r.previousSibling.innerHTML.trim()=="")){r.previousSibling.appendChild(f)}function w(e){f.innerHTML=mxResources.get("error")+": "+mxUtils.htmlEntities(e);f.style.height="24px"}function t(i,e){var D=document.createElement("div");D.style.position="absolute";D.style.overflow="hidden";D.style.left="0px";D.style.top="0px";D.style.right="0px";D.style.fontSize="14px";D.style.margin="2px";mxUtils.setOpacity(D,50);D.style.color="gray";D.style.textAlign="center";D.style.whiteSpace="nowrap";span=document.createElement("span");span.innerHTML=mxUtils.htmlEntities(i);D.appendChild(span);e.appendChild(D);return D}function l(i){var e=null;if(window.mxResourcesLoaded&&mxResources.get("drawio.reader.evaluation")!=null){if(c.licenseStatus=="NO_LICENSE"){e=t(mxResources.get("drawio.reader.noLicense"),i)}else{if(c.licenseStatus=="EVAL_LICENSE"){e=t(mxResources.get("drawio.reader.evaluation"),i)}else{if(c.licenseStatus=="EVAL_EXPIRED"){e=t(mxResources.get("drawio.reader.evaluationExpired"),i)}else{if(c.licenseStatus=="VERSION_MISMATCH"){e=t(mxResources.get("drawio.reader.versionMismatch",["https://support.draw.io/pages/viewpage.action?pageId=11829320"]),i)}else{if(c.licenseStatus=="USER_MISMATCH"){e=t(mxResources.get("drawio.reader.userMismatch",["https://support.draw.io/pages/viewpage.action?pageId=11829323"]),i)}}}}}}return e}function s(E){var D={};try{D=JSON.parse(E)}catch(F){try{mxUtils.parseXml(E);D.xml=E;D.revision="";var i=c.loadUrl.match(/\/([^/]+)$/);D.name=i.length>=2?decodeURIComponent(i[1]):""}catch(F){}}return D}function n(E,e){if(E!=null){var i=E.openLink;E.openLink=function(H,I){var F=window;if(H.substring(0,this.baseUrl.length)==this.baseUrl&&H.charAt(this.baseUrl.length)=="#"&&I=="_top"&&window==window.top){var G=document.createElement("a");G.href="#"+MXGRAPH.resolvePageTargetName(e,H.split("#")[1]);G.style.display="none";f.appendChild(G);G.click();G.parentNode.removeChild(G)}else{if(H.lastIndexOf("/lightbox.action")!=-1){F=i.apply(this,[H,"_blank"])}else{F=i.apply(this,arguments)}}return F};var D=E.customLinkClicked;E.customLinkClicked=function(G){var H=AJS.contextPath();if(G.substring(0,19)=="data:confluence/id,"){var K=G.substring(19);var F=window.open();if(K){$.ajax({url:H+"/rest/api/content/"+K,type:"GET",success:function(L){F.location=H+L._links.webui},error:function(){F.document.writeln(mxResources.get("objectNotFound"))}})}else{throw new Error("Empty ID")}}else{if(G.substring(0,16)=="data:scrollPage,"){try{var J=JSON.parse(Base64.decode(G.substring(16)));var F=window.open();F.document.writeln(mxResources.get("connecting")+"...");$.ajax({url:H+"/rest/api/content/"+AJS.Confluence.getContentId(),type:"GET",success:function(N){var L=N.space.key;if(!/^[ -~\t\n\r]+$/.test(J.confTitle)){F.location=H+"/pages/viewpage.action?pageId="+J.confId}else{var M=H+"/display/"+L+"/"+encodeURIComponent(J.confTitle.replace(/\s/g,"+"));$.ajax({url:M,type:"GET",success:function(O){F.location=M},error:function(O){$.ajax({url:H+"/rest/api/content/"+J.confId,type:"GET",success:function(P){F.location=H+"/display/"+L+"/"+encodeURIComponent(P.title.replace(/\s/g,"+"))},error:function(P){F.document.writeln(mxResources.get("pageNotFound"))}})}})}},error:function(){F.document.writeln(mxResources.get("pageNotFound"))}});return true}catch(I){throw new Error("Unexpected Error")}}else{return D.apply(this,arguments)}}}}}function B(i,e){if(i==null||e==null){return}$(i).parents().each(function(D,E){if($(E).data("macro-name")=="ui-expand"){e["check-visible-state"]=false}})}try{var k=c.contextPath;editUrl=c.editUrl;var v=8;Editor.initMath();GraphViewer.initCss();if(typeof DrawioProperties!=="undefined"&&DrawioProperties.uiConfig&&DrawioProperties.uiConfig.fontCss){Editor.configureFontCss(DrawioProperties.uiConfig.fontCss)}if(c.isTemplate){GraphViewer.prototype.checkVisibleState=false}if(!window.mxResourcesLoaded&&c.language!=null){window.mxResourcesLoaded=true;var C=c.language;if(mxResources.isLanguageSupported(C)){mxClient.language=C}mxUtils.getAll([mxResources.getSpecialBundle(RESOURCE_BASE,mxClient.language)||mxResources.getDefaultBundle(RESOURCE_BASE,mxClient.language),c.resourcePath+((C=="de")?"_de":"")+".txt"],function(D){for(var e=0;e<D.length;e++){mxResources.parse(D[e].getText())}});var a=document.head.getElementsByTagName("link");var z=null;for(var x=0;x<a.length;x++){var m=a[x];if(m.getAttribute("type")==="text/css"&&m.getAttribute("rel")==="stylesheet"&&(/.*\/styles\/custom\.css\?spaceKey=.*$/.test(m.getAttribute("href")))){z=m.outerHTML;break}}if(z!=null){var q=PrintDialog.createPrintPreview;PrintDialog.createPrintPreview=function(){var i=q.apply(this,arguments);var e=i.writeHead;i.writeHead=function(D){e.apply(this,arguments);if(z!=null){D.writeln(z)}};return i}}}function o(E){if(typeof DrawioProperties!=="undefined"&&DrawioProperties.serverConfig&&DrawioProperties.serverConfig.linkAdjustments){if(typeof DrawioProperties.serverConfig.linkAdjustments==="string"){try{var G=JSON.parse(mxUtils.decodeHtml(DrawioProperties.serverConfig.linkAdjustments));for(var F=0;F<G.length;F++){G[F].re=new RegExp(G[F].re,G[F].m)}DrawioProperties.serverConfig.linkAdjustments=G}catch(H){console.log("linkAdjustments parsing error",H)}}try{if(typeof DrawioProperties.serverConfig.linkAdjustments==="object"){var G=DrawioProperties.serverConfig.linkAdjustments;for(var F=0;F<G.length;F++){var D=G[F];E=E.replace(D.re,D.r)}}}catch(H){console.log("linkAdjustments error",H)}}return E}var A=Graph.prototype.getAbsoluteUrl;Graph.prototype.getAbsoluteUrl=function(e){if(e!=null){e=o(e);if(e.charAt(0)=="/"&&e.substring(0,k.length)!==k){e=k+e}}return A.apply(this,arguments)};var g=Graph.prototype.getTooltipForCell;Graph.prototype.getTooltipForCell=function(e){var i=null;try{if(mxUtils.isNode(e.value)){i=e.value.getAttribute("link");if(i!=null){e.value.setAttribute("link",o(i))}}return g.apply(this,arguments)}finally{if(i!=null){e.value.setAttribute("link",i)}}};GraphViewer.prototype.toolbarZIndex=1;var p=GraphViewer.prototype.getImageUrl;var d=/^(\.\.\/)*(\.\.)?\/download\//;var b=/.*com.mxgraph.confluence.plugins.diagramly:(drawio|diagramly)-editor/;GraphViewer.prototype.imageBaseUrl=document.location.origin+"/";GraphViewer.prototype.getImageUrl=function(e){if(e==null){return e}if(e.substring(0,4)=="img/"){if(e.indexOf(".svg")!=-1){return SVGLOADER_URL+"?url="+encodeURIComponent(e)}return ATLAS_RESOURCE_BASE+"/"+e}else{if(e.substring(0,5)=="/img/"){return ATLAS_RESOURCE_BASE+e}else{if(d.test(e)){return k+e.substring(e.indexOf("/download/"))}else{if(e.substring(0,10)!="data:image"&&b.test(e)){return ATLAS_RESOURCE_BASE+e.replace(b,"")}else{if(e.indexOf("/drawio/1.0/diagram/getImageAtt")!=-1){return e}else{return p.apply(this,arguments)}}}}}};var u=GraphViewer.prototype.addClickHandler;GraphViewer.prototype.addClickHandler=function(D,i){var e=mxUtils.bind(this,function(){var E=D.container.getElementsByTagName("img");if(E!=null){for(var F=0;F<E.length;F++){E[F].setAttribute("src",this.getImageUrl(E[F].getAttribute("src")))}}});D.model.addListener(mxEvent.CHANGE,e);e();u.apply(this,arguments)};GraphViewer.prototype.showLightbox=function(e,i,D){this.showLocalLightbox()};if(c.width!=null&&c.width!="fixed"){f.style.width=c.width+"px"}function j(e){var i=mxAddSpinner(f);mxUtils.get(c.loadUrl,mxUtils.bind(this,function(I){try{i.parentNode.removeChild(i)}catch(H){console.log("drawio: viewer noise",H)}f.style.minHeight="";if(I.getStatus()<200||I.getStatus()>299){w(I.getStatus())}else{mxStencilRegistry.dynamicLoading=true;l(f);var M=s(I.getText());var J=mxUtils.parseXml(M.xml);if(c.border){f.style.border="1px solid #d0d0d0"}var D={"toolbar-position":c.tbstyle,nav:true,highlight:"#3b73af",border:v,"check-visible-state":false};if(c.links!="auto"){D.target=c.links}if(c.tbstyle=="top"){D.title=(c.diagramDisplayName!=null&&c.diagramDisplayName.length>0?c.diagramDisplayName:M.name)+" ["+M.revision+"]"}if(!c.lightbox){D.lightbox=false}if(c.tbstyle=="hidden"){D.resize=true}else{D.toolbar="edit pages zoom layers tags";if(c.lightbox){D.toolbar+=" lightbox"}}if(c.width=="fixed"){f.style.maxWidth="";D["allow-zoom-out"]=false}else{if(c.width!=null){D["allow-zoom-in"]=true}}D.zoom=isFinite(c.maxScale)?c.maxScale:1;var K=null;viewer=null;D["toolbar-buttons"]={edit:{title:mxResources.get("edit"),enabled:c.editable,image:MXGRAPH.editImage,handler:function(N){if(c.editUrl.lastIndexOf("page-id")==-1){c.editUrl=c.editUrl+"&page="+viewer.currentPage}c.editUrl+="&directEdit=true";MXGRAPH.openEditor(c.editUrl,N.srcElement);MXGRAPH.viewerContainer=f;MXGRAPH.readerOpts=c}}};if(c.aspect!=null&&c.aspect.length>0){pageAndLayers=c.aspect.split(" ");D.layerIds=pageAndLayers.length>1?pageAndLayers.slice(1):null;pageId=pageAndLayers[0];c.editUrl+="&page-id="+pageId;diagrams=J.documentElement.getElementsByTagName("diagram");if(diagrams!=null){for(var G=0;G<diagrams.length;G++){if(diagrams[G].getAttribute("id")==pageId){D.page=G;break}}}}MXGRAPH.overrideGlobalVariables(c);B(f,D);viewer=new GraphViewer(f,J.documentElement,D);n(viewer.graph,c.ceoName);MXGRAPH.overrideCellTooltips(viewer.graph,c.ceoName);MXGRAPH.addCommentsIcon(viewer,f,M.attachmentId);var F=null;EditorUi.prototype.createUi=function(){};EditorUi.prototype.addTrees=function(){};EditorUi.prototype.updateActionStates=function(){};EditorUi.prototype.installNativeClipboardHandler=function(){};EditorUi.prototype.createKeyHandler=function(){var N=new mxKeyHandler(this.editor.graph);N.bindAction=function(){};return N};EditorUi.prototype.getServiceName=function(){return"atlassian"};function E(){if(F==null){F=new EditorUi(new Editor(false,null,null,null,false));F.editor.attachmentInfo={attachmentId:c.attId,revision:c.attVer};F.canComment=function(){return c.canComment}}return F}function L(){if(K!=null){K.window.setVisible(!K.window.isVisible())}else{K=new CommentsWindow(E(),document.body.offsetWidth-380,120,300,350);K.window.setVisible(true);var N=K.window.getElement();N.style.position="fixed"}K.window.getElement().style.zIndex=2000}if(c.canComment){EditorUi.prototype.lightboxToolbarActions=[{icon:Editor.commentImage,tooltip:mxResources.get("comments"),fn:gOpenCommentsFunc}]}if(viewer.graph==null||viewer.graph.model==null){return}viewer.showLocalLightbox=function(N){gOpenCommentsFn=L;var P=GraphViewer.prototype.showLocalLightbox.apply(this,arguments);n(P.editor.graph,c.ceoName);var O=P.destroy;P.destroy=function(){if(K!=null){K.window.setVisible(false)}O.apply(this,arguments)};if(N){L()}return P};if(c.canComment){E().hasUnresolvedComments(function(N){if(N){img=document.getElementById("comments-icon-"+c.attId);img.style.display="inline"}},function(){})}e.resolve(viewer)}}),function(){i.parentNode.removeChild(i);f.style.minHeight="";w(req.getStatus())})}if(c.simpleViewer){var h=document.createElement("img");h.setAttribute("src",c.imageUrl);h.setAttribute("border","0");h.style.cssText="width:100%;box-sizing:border-box;padding:"+v+"px;";if(c.width=="fixed"){f.style.overflow="visible";h.style.width=""}if(c.border){h.style.border="1px solid #d0d0d0"}f.appendChild(h);if(c.lightbox){h.style.cursor="pointer";mxEvent.addListener(h,"click",function(){var e=mxAddSpinner(f,true);mxUtils.get(c.loadUrl,function(D){e.parentNode.removeChild(e);if(D.getStatus()>=200&&D.getStatus()<=299){var i=s(D.getText());var E=mxUtils.parseXml(i.xml);var F=new GraphViewer(null,E.documentElement,{highlight:"#3b73af",nav:true,lightbox:false,toolbar:"pages zoom layers tags","check-visible-state":false});n(F.showLocalLightbox().editor.graph,c.ceoName)}},function(){e.parentNode.removeChild(e)})})}}else{f.style.minHeight="200px";j($deferred)}}catch(y){w(y.message)}return $deferred.promise()}MXGRAPH.addCommentsIcon=function(d,b,c){var a=document.createElement("img");a.style.cssText="position:absolute;bottom: 5px; right: 5px;opacity: 0.25; cursor: pointer;display : none";a.id="comments-icon-"+c;a.setAttribute("title",mxResources.get("showComments"));a.src=Editor.commentImage;a.addEventListener("click",mxUtils.bind(this,function(){d.showLocalLightbox(true)}));b.appendChild(a)};function updateDrawioViewer(b,c,a){viewerConfig=$(this).data("viewerConfig");if(c==viewerConfig.diagramName){$(this).empty();viewerConfig.editUrl=viewerConfig.editUrl.replace(/revision=\d+/,"revision="+a);viewerConfig.loadUrl=viewerConfig.loadUrl.replace(/revision=\d+/,"revision="+a);viewerConfig.attVer=a;createViewer(this,viewerConfig)}}MXGRAPH.openEditor=function(c,b){var a=$('<iframe id="drawioEditor" >');a.appendTo("body");a.css({position:"fixed",width:"100%",height:"100%",top:"0px",left:"0px","border-style":"none",zIndex:9000});a.attr("src",c);MXGRAPH.editorFrame=a;MXGRAPH.editImgEl=b;b.src=window.IMAGE_PATH+"/spin.gif";b.width=21;b.height=21};MXGRAPH.closeEditor=function(){MXGRAPH.editorFrame.remove();MXGRAPH.editorFrame=null;MXGRAPH.viewerContainer=null;MXGRAPH.readerOpts=null;document.body.style.overflow="auto";MXGRAPH.editImgEl.src=MXGRAPH.editImage};MXGRAPH.postSave=function(a,e,c,b){$(".geDiagramContainer").trigger("drawioViewerUpdate",[e,c]);var d=new mxXmlRequest(AJS.contextPath()+"/rest/drawio/1.0/diagram/updateMacros/"+a+"/"+encodeURIComponent(e)+"/"+c+"?diagramWidth="+b,"","POST");d.setRequestHeaders=function(f,g){f.setRequestHeader("X-Atlassian-Token","no-check")};d.send(function(f){},function(f){console.log("There was a problem updating the drawio macro")})};MXGRAPH.overrideCellTooltips=function(b,a){if(b!=null){oldF=b.getTooltipForCell;b.getTooltipForCell=function(c){var d=oldF.apply(this,arguments);if(c.value!=null&&c.value.getAttribute!=null&&c.value.getAttribute("tooltip")!=null){return d}else{return d==null?null:MXGRAPH.resolvePageTargetName(a,d)}}}};function createRemoteViewer(d,k,c){var h=window.location.hostname=="localhost"?"test.draw.io":"ac.draw.io";var i=AJS.Meta.get("user-locale");if(i!=null){var f=i.indexOf("_");if(f>=0){i=i.substring(0,f)}}if(d==null){return}d.style.height="200px";d.style.width="100%";var g=(k.diagramUrl||k.csvFileUrl)?"extUrl":(k.service=="GDrive"?"gdrive":"onedrive");var a=k.extSrvIntegType==3||k.diagramUrl||k.csvFileUrl?AJS.contextPath()+"/plugins/drawio/embedViewer.action?type="+g+"&lang="+i:"https://"+h+"/connect/remote_"+g+"/viewer.html?lang="+i;var b=$('<iframe style="height:100%;width:100%;border:0" src="'+a+'">');$(d).append(b);var e=b[0].contentWindow;var j=mxAddSpinner(d);window.addEventListener("message",function(l){if(l.source==e){var m=JSON.parse(l.data);switch(m.action){case"viewerReady":e.postMessage(JSON.stringify({action:"viewFile",data:k}),"*");j.parentNode.removeChild(j);break;case"diagramRendered":if(c!=null){k.fileTS=m.fileTS;c(k,e)}break;case"updateHeight":d.style.height=m.height+"px";break}}});return e}MXGRAPH.editImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVBAMAAABbObilAAAAD1BMVEUAAAAAAAAQEBBycnIgICBqwj3hAAAAAXRSTlMAQObYZgAAADlJREFUCNdjoBwoChrAmCyGggJwYWVBBSiTSVDICKFa0AEuLCiEJKyAX5gBSZgBSZgBKGwMBKQ7HAAWzQSfKKAyBgAAAABJRU5ErkJggg==";