WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.refinedwiki.confluence.plugins.theme.original:65', location = 'site-switcher-controller.394c74e137dfee5a5132.js' */
(window.webpackJsonpRefinedConfluenceWebPack=window.webpackJsonpRefinedConfluenceWebPack||[]).push([[65],{764:function(t,e,n){"use strict";n.r(e),n.d(e,"SiteSwitcherController",(function(){return h}));var i=n(8),a=n(797),s=n(976),r=n(977),o=n(974),E=n(975),N=n(775);const c={data:()=>({contextPath:window.contextPath})};var l=n(772),d={props:{label:{type:String,required:!0}}},u=n(1);var S={components:{RBaseButton:Object(u.a)(d,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("button",{staticClass:"rw_base_button",attrs:{"aria-label":t.label},on:{click:function(e){return t.$emit("click")}}},[t._t("default")],2)}),[],!1,null,"613b603b",null).exports},mixins:[{data:()=>({theme:window.RW._theme.attributes})},N.a],computed:{roundedCorners(){return("tabs"===this.theme.navmenu_variant||"traditional"===this.theme.navmenu_variant)&&this.theme.navMenuCorners_boolean},cssVariables(){return{"--rw-navmenu-textcolor":this.theme.navMenuTextColour_colour,"--rw-navmenu-textcolor-hover":this.theme.navMenuHoverTextColour_colour}}}},T=Object(u.a)(S,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("r-base-button",{staticClass:"rw_site_switcher_button",class:{rw_rounded_corners:t.roundedCorners},style:t.cssVariables,attrs:{id:"rw_site_switcher_button",label:t.getText("rw.topMenu.site-switcher.label")}},[n("i",{staticClass:"ext_ui_icon rw_external_icon_bars"})])}),[],!1,null,"f3fd40a8",null).exports,A=Object(u.a)({},(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{margin:"0 1rem",display:"flex","flex-direction":"column",padding:"0 0.375rem"}},[e("el-skeleton-item",{staticStyle:{width:"120px",height:"1.125rem",margin:"1rem 0"},attrs:{variant:"rect",animated:"",throttle:500}}),e("el-skeleton-item",{staticStyle:{width:"200px",height:"1rem","margin-bottom":"1rem"},attrs:{variant:"rect",animated:"",throttle:500}}),e("el-skeleton-item",{staticStyle:{width:"200px",height:"1rem","margin-bottom":"1rem"},attrs:{variant:"rect",animated:"",throttle:500}})],1)}),[],!1,null,null,null).exports,_={components:{ExtDropdown:s.a,ExtDropdownMenu:r.a,ExtDropdownSection:o.a,ExtDropdownItem:E.a,SiteSwitcherButton:T,SiteSwitcherSectionSkeleton:A},mixins:[N.a,c],props:{siteId:{type:String,required:!0}},data:()=>({sites:[],integrations:[],links:[],integrationsLoading:!1,additionalLinksLoading:!1}),async mounted(){null===this.$store.state.site._siteSwitcherSites&&(this.integrationsLoading=!0,await this.$store.dispatch(l.a.GET_SITE,{id:this.siteId}),this.integrationsLoading=!1),this.sites=this.$store.getters.siteSwitcherSites,await this.fetchLinks()},methods:{getSiteHref(t){let{id:e,type:n,urlSuffix:i}=t;return 0===e?`${this.contextPath}/dashboard.action`:"blog"===n?`${this.contextPath}/blog/`:`${this.contextPath}/site/${i}`},async fetchLinks(){null!==this.$store.state.appSwitcher._links&&null!==this.$store.state.siteSwitcher._externalSites||(this.additionalLinksLoading=!0,await Promise.all([this.$store.dispatch(l.a.GET_SITE_SWITCHER_LINKS),this.$store.dispatch(l.a.GET_APP_SWITCHER_LINKS)]),this.additionalLinksLoading=!1);const t=this.$store.getters.appSwitcherLinks,e=this.$store.getters.externalSites;this.filterAndAssignLinks(t,e)},filterAndAssignLinks(t,e){this.integrations=e.filter((t=>!0!==t.self));this.links=t.filter((t=>{let e=!0;return e=!t.self,this.integrations.forEach((n=>{((t,e)=>!e.self&&!e.local&&"jira"===e.applicationType&&(t.link.length>e.link.length?t.link.startsWith(e.link):e.link.startsWith(t.link)))(n,t)&&(e=!1)})),e}))}}},I=Object(u.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ext-dropdown",{attrs:{trigger:"click"}},[n("site-switcher-button"),n("ext-dropdown-menu",{staticClass:"rw_site_switcher",attrs:{slot:"dropdown","data-keynav-id":"rw_site_switcher_menu",type:"main","active-index":t.siteId},slot:"dropdown"},[t.integrationsLoading&&!t.sites.length?n("ext-dropdown-section",[n("site-switcher-section-skeleton")],1):n("ext-dropdown-section",{attrs:{title:t.getText("rw.topMenu.site-switcher.sites")}},t._l(t.sites,(function(e){var i=e.id,a=e.name,s=e.type,r=e.urlSuffix;return n("ext-dropdown-item",{key:i,attrs:{href:t.getSiteHref({id:i,type:s,urlSuffix:r}),index:i.toString()}},[t._v(" "+t._s(a)+" ")])})),1),t.additionalLinksLoading&&!t.integrations.length?n("ext-dropdown-section",[n("site-switcher-section-skeleton")],1):t._e(),t._l(t.integrations,(function(e){var i=e.id,a=e.label,s=e.link,r=e.sites;return n("ext-dropdown-section",{key:i,attrs:{title:a,href:s}},t._l(r,(function(e){return n("ext-dropdown-item",{key:e.id,attrs:{href:e.link}},[t._v(" "+t._s(e.label)+" ")])})),1)})),t.additionalLinksLoading&&!t.links.length?n("ext-dropdown-section",[n("site-switcher-section-skeleton")],1):t._e(),t.links&&t.links.length?n("ext-dropdown-section",t._l(t.links,(function(e){var i=e.id,a=e.label,s=e.link;return n("ext-dropdown-item",{key:i,attrs:{href:s}},[t._v(" "+t._s(a)+" ")])})),1):t._e()],2)],1)}),[],!1,null,"778c5445",null).exports,m=(n(884),n(885));const h={init(t){let{selector:e,siteId:n}=t;i.default.use(m.Skeleton),i.default.use(m.SkeletonItem),new i.default({store:a.a,render:t=>t(I,{props:{siteId:n.toString()}})}).$mount(e)}}},772:function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return r}));const i={API:{ERROR:"apiError",PENDING_GET_REQUESTS:"pendingGetRequests",SUCCESS:"apiSuccess"},ANNOUNCEMENT_BANNERS:"announcementBanners",INTEGRATIONS:"integrations",SITES:"sites",LOADING:"loading"},a={API:{ADD_PENDING_GET_REQUESTS:"addPendingGetRequests",DELETE_PENDING_GET_REQUESTS:"deletePendingGetRequests",SET_ERROR:"apiError",SET_SUCCESS:"apiSuccess"},SET_ANNOUNCEMENT_BANNERS:"setAnnouncementBanners",ADD_ANNOUNCEMENT_BANNER:"addAnnouncementBanner",REMOVE_ANNOUNCEMENT_BANNER:"removeAnnouncementBanner",UPDATE_ANNOUNCEMENT_BANNER:"updateAnnouncementBanner",SET_INTEGRATIONS:"setIntegrations",SAVE_INTEGRATION_CONFIGURATION:"saveIntegrationConfiguration",REMOVE_INTEGRATION:"removeIntegration",SET_SITES:"setSites"},s={API:{GET:"getRequest",PUT:"putRequest",POST:"postRequest",DELETE:"deleteRequest",PATCH:"patchRequest"},GET_ANNOUNCEMENT_BANNERS:"getAnnouncementBanners",DELETE_ANNOUNCEMENT_BANNER:"deleteAnnouncementBanner",ADD_ANNOUNCEMENT_BANNER:"addAnnouncementBanner",UPDATE_ANNOUNCEMENT_BANNER:"updateAnnouncementBanner",GET_INTEGRATIONS:"getIntegrations",GET_SITES:"getSites",SAVE_INTEGRATION_CONFIGURATION:"saveIntegrationConfiguration",DELETE_INTEGRATION:"deleteIntegration",GET_SITE:"getSite",GET_APP_SWITCHER_LINKS:"getAppSwitcherLinks",GET_SITE_SWITCHER_LINKS:"getSiteSwitcherLinks"},r={GET_ANNOUNCEMENT_BANNERS:"getAnnouncementBanners",GET_INTEGRATIONS:"getIntegrations",GET_SITES:"getSites",IS_LOADING:"isLoading"}},775:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));const i={methods:{getText(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return AJS.I18n.getText(t,...n)}}}},789:function(t,e,n){"use strict";var i=n(850),a=n(772);const s=async t=>{const{commit:e,mutation:n,url:s,data:r,fullData:o,originalData:E,methodType:N}=t;if("PUT"===N||"PATCH"===N)try{const t="PUT"===N?await i.a.put(s,r):await i.a.patch(s,r);return n&&e(n,t.data),e(a.c.API.SET_SUCCESS),t.data}catch(t){return e(a.c.API.SET_ERROR,t),"PUT"===N&&n&&o&&e(n,E),null}};e.a={NAME:"api",state:{[a.d.API.ERROR]:null,[a.d.API.PENDING_GET_REQUESTS]:new Set,[a.d.API.SUCCESS]:null},mutations:{[a.c.API.SET_ERROR](t,e){let n;try{n=e.response?{title:`${e.response.status} ${e.response.statusText}`,message:e.response.data.message}:{title:e.code,message:e.message}}catch(t){n={title:"Error",message:"rw.refinedsites.error"}}t[a.d.API.ERROR]=n},[a.c.API.ADD_PENDING_GET_REQUESTS](t,e){t[a.d.API.PENDING_GET_REQUESTS].add(e)},[a.c.API.DELETE_PENDING_GET_REQUESTS](t,e){t[a.d.API.PENDING_GET_REQUESTS].delete(e)},[a.c.API.SET_SUCCESS](t){t[a.d.API.SUCCESS]={message:"Your changes have been saved"}}},actions:{async[a.a.API.GET](t,e){let n,{state:s,commit:r}=t,{url:o,currentState:E,noCache:N,hideErrorNotification:c}=e;const l=s[a.d.API.PENDING_GET_REQUESTS].has(o);if(!E&&!l||N){r(a.c.API.ADD_PENDING_GET_REQUESTS,o);try{n=await i.a.get(o)}catch(t){c||r(a.c.API.SET_ERROR,t)}r(a.c.API.DELETE_PENDING_GET_REQUESTS,o)}return n?n.data:E},async[a.a.API.PUT](t,e){let{commit:n}=t,{url:i,data:a,mutation:r,fullData:o}=e;const E={...o};r&&o&&n(r,{...o,...a});return s({commit:n,mutation:r,url:i,data:a,originalData:E,fullData:o,methodType:"PUT"})},async[a.a.API.PATCH](t,e){let{commit:n}=t,{url:i,data:a,mutation:r}=e;return s({commit:n,mutation:r,url:i,data:a,methodType:"PATCH"})},async[a.a.API.POST](t,e){let{commit:n}=t,{url:s,data:r,mutation:o}=e;try{const t=await i.a.post(s,r);return o&&n(o,t.data),n(a.c.API.SET_SUCCESS),t.data}catch(t){return n(a.c.API.SET_ERROR,t),null}},async[a.a.API.DELETE](t,e){let{commit:n}=t,{url:s}=e;try{return await i.a.delete(s),n(a.c.API.SET_SUCCESS),!0}catch(t){return n(a.c.API.SET_ERROR,t),!1}}}}},797:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var i=n(8),a=n(17),s=n(772),r=n(789),o=n(798),E=n(799),N=n(800),c=n(801),l=n(802);i.default.use(a.a);const d=new a.a.Store({state:{[s.d.LOADING]:!0},modules:{[r.a.NAME]:r.a,announcements:o.a,integrations:E.a,site:N.a,appSwitcher:c.a,siteSwitcher:l.a},getters:{[s.b.IS_LOADING]:t=>t[s.d.LOADING]}})},798:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a}));var i=n(772);const a={state:{[i.d.ANNOUNCEMENT_BANNERS]:null},mutations:{[i.c.SET_ANNOUNCEMENT_BANNERS](t,e){t[i.d.ANNOUNCEMENT_BANNERS]=e},[i.c.UPDATE_ANNOUNCEMENT_BANNER](t,e){t[i.d.ANNOUNCEMENT_BANNERS]=t[i.d.ANNOUNCEMENT_BANNERS].map((t=>t.id===e.id?e:t))},[i.c.ADD_ANNOUNCEMENT_BANNER](t,e){t[i.d.ANNOUNCEMENT_BANNERS]=[...t[i.d.ANNOUNCEMENT_BANNERS],e]},[i.c.REMOVE_ANNOUNCEMENT_BANNER](t,e){t[i.d.ANNOUNCEMENT_BANNERS]=t[i.d.ANNOUNCEMENT_BANNERS].filter((t=>t.id!==e.id))}},actions:{async[i.a.GET_ANNOUNCEMENT_BANNERS](e){let{commit:n,state:a,dispatch:s,rootState:r}=e;r[i.d.LOADING]=!0,n(i.c.SET_ANNOUNCEMENT_BANNERS,null);const o=await s(i.a.API.GET,{url:`${t()}/rest/refinedtheme/latest/announcement/?admin=true`,currentState:a[i.d.ANNOUNCEMENT_BANNERS]});n(i.c.SET_ANNOUNCEMENT_BANNERS,o),r[i.d.LOADING]=!1},async[i.a.DELETE_ANNOUNCEMENT_BANNER](e,n){let{commit:a,dispatch:s,rootState:r}=e,{announcementBanner:o}=n;r[i.d.LOADING]=!0;await s(i.a.API.DELETE,{url:`${t()}/rest/refinedtheme/latest/announcement/${o.id}`})&&a(i.c.REMOVE_ANNOUNCEMENT_BANNER,o),r[i.d.LOADING]=!1},async[i.a.ADD_ANNOUNCEMENT_BANNER](e,n){let{commit:a,dispatch:s,rootState:r}=e;r[i.d.LOADING]=!0;const o=await s(i.a.API.POST,{url:`${t()}/rest/refinedtheme/latest/announcement/`,data:n});a(i.c.ADD_ANNOUNCEMENT_BANNER,o),r[i.d.LOADING]=!1},async[i.a.UPDATE_ANNOUNCEMENT_BANNER](e,n){let{state:a,dispatch:s,rootState:r}=e;r[i.d.LOADING]=!0;const o=a[i.d.ANNOUNCEMENT_BANNERS].find((t=>{let{id:e}=t;return e===n.id}));await s(i.a.API.PUT,{url:`${t()}/rest/refinedtheme/latest/announcement/${n.id}`,data:n,mutation:i.c.UPDATE_ANNOUNCEMENT_BANNER,fullData:o}),r[i.d.LOADING]=!1}},getters:{[i.b.GET_ANNOUNCEMENT_BANNERS]:t=>null!==t[i.d.ANNOUNCEMENT_BANNERS]?[...t[i.d.ANNOUNCEMENT_BANNERS]]:null}}}).call(this,n(15).default)},799:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a}));var i=n(772);const a={state:{[i.d.INTEGRATIONS]:null,[i.d.SITES]:null},mutations:{[i.c.SET_INTEGRATIONS](t,e){t[i.d.INTEGRATIONS]=e},[i.c.SAVE_INTEGRATION_CONFIGURATION](t,e){let{id:n,jsm:a,configuration:s}=e;t[i.d.INTEGRATIONS].enabled=t[i.d.INTEGRATIONS].enabled.map((t=>t.id===n&&t.jsm===a?(t.configuration=s,t):t));let r=t[i.d.INTEGRATIONS].available;const o=r.filter((t=>t.id===n&&t.jsm===a)).map((t=>(t.configuration=s,t)));t[i.d.INTEGRATIONS].enabled=[...t[i.d.INTEGRATIONS].enabled,...o],r=r.filter((t=>t.id!==n||t.jsm!==a)),t[i.d.INTEGRATIONS].available=r},[i.c.REMOVE_INTEGRATION](t,e){let{id:n,jsm:a}=e,s=t[i.d.INTEGRATIONS].enabled;const r=s.filter((t=>t.id===n&&t.jsm===a)).map((t=>(t.configuration=null,t)));t[i.d.INTEGRATIONS].available=[...t[i.d.INTEGRATIONS].available,...r],s=s.filter((t=>t.id!==n||t.jsm!==a)),t[i.d.INTEGRATIONS].enabled=s},[i.c.SET_SITES](t,e){t[i.d.SITES]=e}},actions:{async[i.a.GET_INTEGRATIONS](e){let{commit:n,state:a,dispatch:s,rootState:r}=e;r[i.d.LOADING]=!0,n(i.c.SET_INTEGRATIONS,null);const o=await s(i.a.API.GET,{url:`${t()}/rest/refinedtheme/latest/integrations`,currentState:a[i.d.INTEGRATIONS]});n(i.c.SET_INTEGRATIONS,o),r[i.d.LOADING]=!1},async[i.a.SAVE_INTEGRATION_CONFIGURATION](e,n){let{commit:a,dispatch:s,rootState:r}=e,{id:o,jsm:E,configuration:N}=n;r[i.d.LOADING]=!0;await s(i.a.API.POST,{url:`${t()}/rest/refinedtheme/latest/integrations/${o}?isJsm=${E}`,data:N})&&a(i.c.SAVE_INTEGRATION_CONFIGURATION,{id:o,jsm:E,configuration:N}),r[i.d.LOADING]=!1},async[i.a.DELETE_INTEGRATION](e,n){let{commit:a,dispatch:s,rootState:r}=e,{id:o,jsm:E}=n;r[i.d.LOADING]=!0;await s(i.a.API.DELETE,{url:`${t()}/rest/refinedtheme/latest/integrations/${o}?isJsm=${E}`})&&a(i.c.REMOVE_INTEGRATION,{id:o,jsm:E}),r[i.d.LOADING]=!1},async[i.a.GET_SITES](e,n){let{commit:a,state:s,dispatch:r,rootState:o}=e,{id:E}=n;void 0===E&&(E=""),o[i.d.LOADING]=!0,a(i.c.SET_SITES,null);const N=await r(i.a.API.GET,{url:`${t()}/rest/refinedtheme/latest/integrations/${E}/sites`,currentState:s[i.d.SITES]});a(i.c.SET_SITES,N),o[i.d.LOADING]=!1}},getters:{[i.b.GET_INTEGRATIONS]:t=>null!==t[i.d.INTEGRATIONS]?t[i.d.INTEGRATIONS]:null,[i.b.GET_SITES]:t=>null!==t[i.d.SITES]?t[i.d.SITES]:null}}}).call(this,n(15).default)},800:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a}));var i=n(772);const a={state:{_siteSwitcherSites:null},getters:{siteSwitcherSites:t=>t._siteSwitcherSites},mutations:{setSiteSwitcherSites(t,e){t._siteSwitcherSites=e}},actions:{async[i.a.GET_SITE](e,n){let{dispatch:a,commit:s}=e,{id:r}=n;s("setSiteSwitcherSites",await a(i.a.API.GET,{url:`${t()}/rest/refinedtheme/latest/site?_=${r}`,noCache:!0}))}}}}).call(this,n(15).default)},801:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a}));var i=n(772);const a={state:{_links:null},getters:{appSwitcherLinks:t=>t._links},mutations:{setLinks(t,e){t._links=e}},actions:{async[i.a.GET_APP_SWITCHER_LINKS](e){let{dispatch:n,commit:a}=e;a("setLinks",await n(i.a.API.GET,{url:`${t()}/rest/menu/1.0/appswitcher`,noCache:!0}))}}}}).call(this,n(15).default)},802:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a}));var i=n(772);const a={state:{_externalSites:null},getters:{externalSites:t=>t._externalSites},mutations:{setExternalSites(t,e){t._externalSites=e}},actions:{async[i.a.GET_SITE_SWITCHER_LINKS](e){let{dispatch:n,commit:a}=e;a("setExternalSites",await n(i.a.API.GET,{url:`${t()}/rest/refinedtheme/latest/external/site-switcher`,noCache:!0}))}}}}).call(this,n(15).default)}}]);
}catch(e){WRMCB(e)};