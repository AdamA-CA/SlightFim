WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.refinedwiki.confluence.plugins.theme.original:69', location = 'spaces-macro.6be576339ccdd706e57b.js' */
(window.webpackJsonpRefinedConfluenceWebPack=window.webpackJsonpRefinedConfluenceWebPack||[]).push([[69],{648:function(e,t,a){"use strict";a.r(t),function(e){a.d(t,"SpacesMacroController",(function(){return b}));var s=a(0),c=a.n(s),r=a(2),i=a(4),o=a(13),n=a(173),l=a(34),d=a(55),p=a(14),u=a(911);let _,m,g,h,w,y,f,v;const b={init(){void 0===window.RW._siteId&&(window.RW._siteId=0),_=c()(u.a({})),m=c()(u.c()),g=c()(p.contentItem()),h=c()(u.e()),w=c()(u.d()),y=c()(RWJS.Templates.Utils.loader({size:"medium"})),f=c()(p.item());for(let e=0;e<c()(".rw_spaces_macro","#main").length;e++){const t=c()(c()(".rw_spaces_macro","#main")[e]);t.attr("id",`rw_spaces_macro_${e}`),t.data("closedcategories",c()("#spacesVarClosedCategories",t).html()),t.data("showlogo",c()("#spacesVarShowLogo",t).html());let a=c()("#spacesVarExcludeArchivedSpaces",t).html();a||(a="false"),t.data("excludearchivedspaces",a);let s=c()("#spacesVarIncludeLinks",t).html();s||(s="false"),t.data("includelinks",s),t.data("excludeDescriptions",c()("#spacesVarExcludeDescriptions",t).html());let r=c()("#spacesVarExcludeUncategorizedSpaces",t).html();r||(r="false"),t.data("excludeuncategorizedspaces",r),v=c()("#spacesVarManualPermissions",t).html(),t.data("isspacedirectory",!1),c()("#rw_spaces_menu",t).attr("id",`rw_spaces_menu_${e}`),c()(".rw_spaces_menu_button",t).addClass("aui-dropdown2-trigger").attr("aria-owns",`rw_spaces_menu_${e}`).attr("aria-controls",`rw_spaces_menu_${e}`),S(t)}},toggleCategorySection(e){!function(e){c()(e).closest(".rw_category").toggleClass("rw_closed")}(e)},filterSpaces(e,t){J(e,t,"","",!1)},filterSpacesWithSelectedTeam(e,t,a){J(e,t,"",a,!1)},filterSpacesWithFilters(e,t,a,s,c){J(e,t,a,s,c)}};function S(e){const t="true"===c()("#spacesVarSpaceDirectory",e).html(),a=`spaces-macro.state${e.attr("id")}`;let s;void 0===o.Storage.getValue(a)||t||(s=JSON.parse(o.Storage.getValue(a)),s&&s.spacesSelectedTab&&e.data("option",s.spacesSelectedTab));const r=e.data("option");c()(".rw_spaces_menu_button",e).html(c()(`.rw_option_${r} a`,e).html()),c()(".rw_spaces_menu a",e).click((function(){c()(".rw_spaces_menu_button",e).html(c()(this).html()),b.filterSpaces(c()(this).data("option"),e)})),c()(".rw_spaces_menu_button",e).click((function(){if(D(e),RW._versionChecker.comparedTo74>=0){if(c()(".rw_spaces_menu_button",e),!e.data("isspacedirectory")){let t=c()(".rw_spaces_menu_button",e).attr("aria-owns");t||(t=c()(".rw_spaces_menu_button",e).attr("aria-controls")),RW._versionChecker.comparedTo712>=0?(c()(`#${t}`).attr("open",((e,t)=>t?null:"true")),c()(`#${t}`).css("position","absolute")):c()(`#${t}`).attr("aria-hidden",((e,t)=>"false"!==t?"false":"true"))}return!1}})),RW._versionChecker.comparedTo710>=0?c()("body").click((function(){RW._versionChecker.comparedTo712>=0?c()(".rw_spaces_menu").removeAttr("open"):c()(".rw_spaces_menu").attr("aria-hidden","true")})):c()("body").click((function(){c()(".rw_spaces_menu").attr("aria-hidden","true")}));let i=c()("#spacesVarSelectedTeam",e).html();if(s&&"team"===s.spacesSelectedTab&&(i=s.selectedCategory,e.data("selectedteamlabel",s.selectedCategory)),e.data("category",i),i&&i.length>0&&D(e),c()("#spacesVarCategoryKey",e).length>0)x(c()("#spacesVarCategoryKey",e).html(),c()("#rw_spaces_macro_container",e),e);else{e.data("selectedteamlabel",c()("#spacesVarSelectedTeam",e).html()),"true"===c()("#spacesVarSpaceDirectory",e).html()&&e.data("isspacedirectory",!0);let t=c()("#spacesVarSpacesSelectedTab",e).html(),a=e.data("selectedteamlabel");s&&s.spacesSelectedTab&&(t=s.spacesSelectedTab,"team"===t&&(a=s.selectedCategory)),U(t,a,"",e.data("isspacedirectory"),e),e.data("isspacedirectory")&&D(e)}}function C(e){return e.data("closedcategories",c()("#spacesVarClosedCategories",e).html()),e.data("showlogo",c()("#spacesVarShowLogo",e).html()),e.data("excludearchivedspaces",c()("#spacesVarExcludeArchivedSpaces",e).html()),e.data("includelinks",c()("#spacesVarIncludeLinks",e).html()),e.data("excludeDescriptions",c()("#spacesVarExcludeDescriptions",e).html()),e.data("excludeuncategorizedspaces",c()("#spacesVarExcludeUncategorizedSpaces",e).html()),v=c()("#spacesVarManualPermissions",e).html(),{closedCategories:e.data("closedcategories"),showLogo:e.data("showlogo"),excludeArchivedSpaces:e.data("excludearchivedspaces"),includeLinks:"true"===e.data("includelinks"),isSpaceDirectory:e.data("isspacedirectory"),excludeDescriptions:e.data("excludeDescriptions"),showDashboards:e.data("showDashboards"),excludeUncategorizedSpaces:e.data("excludeuncategorizedspaces")}}function T(t){const a=c()("#rw_spaces_macro_container",t);a.html(y);const s=t.data();let r=s&&s.excludearchivedspaces;r&&r.trim&&(r=r.trim());let i=s&&s.includelinks;i&&i.trim&&(i=i.trim()),c.a.ajax({url:`${e()}/rest/refinedtheme/latest/category?include-children=true&recursive=true&exclude-archived-spaces=${r}&exclude-links=${"true"!==i}&site-id=${window.RW._siteId}`,type:"GET",dataType:"json",success(e){a.html(""),void 0!==e&&e.length>0&&E(e,c()("#rw_spaces_macro_container",t),C(t),t),"true"!==t.data("excludeuncategorizedspaces")&&function(e,t,a){const s=c()("<div></div>");W(s,t,a),e.append(s)}(c()("#rw_spaces_macro_container",t),t,void 0===e||0===e.length)},error(e){k(e,t)}})}function k(e,t){const a=c()("#rw_spaces_macro_container",t);0!==e.status&&(404===e.status?a.html(w.clone()).show():a.html(`<div class='rw_warning_box'>${e.status} ${e.statusText}</div>`).show())}function $(t){const a=c()("#rw_spaces_macro_container",t);a.html(y);const s=t.data();let o=s&&s.excludearchivedspaces;o&&o.trim&&(o=o.trim()),c.a.ajax({url:`${e()}/rest/refinedtheme/latest/category?exclude-archived-spaces=${o}&site-id=${window.RW._siteId}`,type:"GET",dataType:"json",success(s){a.html(""),void 0!==s&&s.length>0&&function(t,a,s,o){void 0!==t&&c.a.each(t,(function(){if("category"===this.type){let t,d=this.nameKey;t=o.showDashboards&&!this.categoryHomeDisabled?c()(u.b({})):_.clone();const p=c()("div.rw_spaces_category_title",t),m=c()("div.rw_spaces_category_title span",t),g=c()("div.rw_spaces_subcategories",t);d=this.nameKey;const h=c()(".rw_item_expand",t);if(b.toggleCategorySection(p),m.html(i.f.htmlEncode(this.name)),void 0!==this.link&&!1===this.link.defaultLink){const e=this.link.url;m.addClass("rw_custom_link"),void 0!==this.link.target?(m.append('<span class="rw_new_window"></span>'),p.click((function(){window.open(e)}))):p.click((function(){window.location=e}))}else{let t;t=o.showDashboards&&!this.categoryHomeDisabled?h:p,t.click((function(){b.toggleCategorySection(this)})).click((function(e){x(d,g,s),p.unbind(e)})),o.showDashboards&&!this.categoryHomeDisabled&&p.click((function(){window.location=`${e()}/category/${d}`}))}RWJS.PubSub.on("user-categories:fetched",(function(){const e=s.data("showUsers");if(!r.default.isEmpty(l.a.userCategories)&&l.a.userCategories.get(d)&&!0===e&&!p.hasClass("rw_has_user_category")){const e=new n.UserCategoryButtonView({categoryKey:d});m.after(e.render()),p.addClass("rw_has_user_category")}})),r.default.isEmpty(l.a.userCategories)||RWJS.PubSub.trigger("user-categories:fetched"),a.append(t)}}))}(s,a,t,C(t)),"true"!==t.data("excludeuncategorizedspaces")&&function(e,t,a){let s;s=a.showDashboards?c()(u.b({})):_.clone();const r=c()("div.rw_spaces_category_title",s),i=c()("div.rw_spaces_category_title span",s),o=c()("ul.rw_content_list",s),n=c()(".rw_item_expand",s);s.addClass("rw_uncategorized_spaces"),b.toggleCategorySection(r),i.html("Uncategorized spaces"),r.click((function(){b.toggleCategorySection(this)})).click((function(e){W(o,t,!0),r.unbind(e)})),n.click((function(){b.toggleCategorySection(this)})).click((function(e){W(o,t,!0),n.unbind(e)})),e.append(s)}(a,t,C(t))},error(e){k(e,t)}})}function x(t,a,s){a.html(y);const r="true"!==C(s).closedCategories;c.a.ajax({url:`${e()}/rest/refinedtheme/latest/category/${t.trim()}/?include-children=true&recursive=${r}&exclude-archived-spaces=${s.data("excludearchivedspaces").trim()}&exclude-links=${"true"!==s.data("includelinks").trim()}&site-id=${window.RW._siteId}`,type:"GET",dataType:"json",success(e){a.html(""),void 0!==e.children&&0!==e.children.length||void 0!==e.subCategories&&0!==e.subCategories.length?function(e,t,a,s){if("category"===e.type){const r=m.clone(),i=c()("ul.rw_content_list",r),o=c()("div.rw_spaces_subcategories",r);I(e.children,i,a),E(e.subCategories,o,a,s),t.append(r)}}(e,a,C(s),s):a.html(w.clone())},error(e){k(e,s)}})}function W(t,a,s){t.html(y),c.a.ajax({url:`${e()}/rest/refinedtheme/latest/space/uncategorized?exclude-archived-spaces=${a.data("excludearchivedspaces")}&siteId=${window.RW._siteId}`,type:"GET",dataType:"json",success(e){t.html(""),void 0!==e&&e.length>0?j({children:e},t,C(a)):s&&t.html(w.clone())},error(e){k(e,a)}})}function D(t){let a;if(t.data("isspacedirectory"))a=c()(".rw_space_filter_menu",t);else{let e=c()(".rw_spaces_menu_button",t).attr("aria-owns");e||(e=c()(".rw_spaces_menu_button",t).attr("aria-controls")),a=c()(".rw_option_categories",`#${e}`)}t.data("categories-loaded")||(t.data("isspacedirectory")||a.append("<li><a>Loading...</a></li>"),c.a.ajax({url:`${e()}/rest/refinedtheme/latest/category?site-id=${window.RW._siteId}`,type:"GET",dataType:"json",success(e){t.data("categories-loaded",!0),t.data("isspacedirectory")||a.html("");let s=!1;void 0!==e&&e.length>0?c.a.each(e,(function(){void 0!==this.url&&""!==this.url||(!function(e,t,a){const s=f.clone(),r=c()("a",s);s.attr("id",`rw_team_${i.f.htmlEncode(e.nameKey)}`),a.data("category")===e.nameKey&&(a.data("isspacedirectory")?s.addClass("rw_active"):c()(".rw_spaces_menu_button",a).html(i.f.htmlEncode(e.name)));r.html(i.f.htmlEncode(e.name)).click((function(){c()(".rw_spaces_menu_button",a).html(c()(this).html()),b.filterSpacesWithFilters("team",a,e.nameKey,"",a.data("isspacedirectory"))})),t.append(s)}(this,a,t),s=!0)})):t.data("isspacedirectory")||a.remove(),s||a.parent().remove()},error(){}}))}function E(t,a,s,o){void 0!==t&&c.a.each(t,(function(){"category"===this.type&&function(t,a,s,o){if(void 0!==t.link);else{if(!("true"===s.closedCategories||void 0!==t.children&&0!==t.children.length||void 0!==t.subCategories&&0!==t.subCategories.length))return;if("true"!==s.closedCategories&&(void 0===t.children||0===t.children.length)&&!R(t.subCategories))return}let d,p=!1;!s.showDashboards||t.categoryHomeDisabled?d=_.clone():(d=c()(u.b({})),p=!0);const m=c()("div.rw_spaces_category_title",d),g=c()("div.rw_spaces_category_title span",d),h=c()("ul.rw_content_list",d),y=c()("div.rw_spaces_subcategories",d),f=c()(".rw_item_expand",d);"true"===s.closedCategories&&b.toggleCategorySection(m);if(g.html(i.f.htmlEncode(t.name)),void 0!==t.link&&!1===t.link.defaultLink){const e=t.link.url;g.addClass("rw_custom_link"),void 0!==t.link.target?(g.append('<span class="rw_new_window"></span>'),m.click((function(){window.open(e)}))):m.click((function(){window.location=e}))}else{let s;s=p?f:m,s.click((function(){const e=c()(".rw_spaces_category_content",d);0===c()("ul.rw_content_list",e).children().length&&0===c()("div.rw_spaces_subcategories",e).children().length&&(c()(".rw_no_items",a).remove(),x(t.nameKey,e,o)),b.toggleCategorySection(this)})),p&&m.click((function(){window.location=`${e()}/category/${t.nameKey}`}))}"true"===s.closedCategories||void 0!==t.children&&0!==t.children.length||void 0!==t.subCategories&&0!==t.subCategories.length?(I(t.children,h,s),E(t.subCategories,y,s,o)):void 0!==t.link&&!0!==t.link.defaultLink||h.append(w.clone());RWJS.PubSub.on("user-categories:fetched",(function(){const e=o.data("showUsers");if(!r.default.isEmpty(l.a.userCategories)&&l.a.userCategories.get(t.nameKey)&&!0===e&&!m.hasClass("rw_has_user_category")){const e=new n.UserCategoryButtonView({categoryKey:t.nameKey});g.after(e.render()),m.addClass("rw_has_user_category")}})),r.default.isEmpty(l.a.userCategories)||RWJS.PubSub.trigger("user-categories:fetched");a.append(d)}(this,a,s,o)}))}function R(e){for(let t=0;t<e.length;t++){const a=e[t];return a.children.length>0||R(a.subCategories)}return!1}function V(t,a,s,r){"space"===t.type?function(t,a,s,r){const o=g.clone(),n=c()("a",o),l=c()("span.rw_item_content",o),p=c()("span.rw_item_favourite",o),u=t.key;l.html(i.f.htmlEncode(t.title)),l.attr("title",t.title),s%2==0&&o.addClass("rw_alternating");RW._remoteUser?(t.favourite?p.addClass("rw_selected").attr("title","Remove from your favourite list"):p.attr("title","Add to your favourite list"),p.click((function(e){return Object(d.toggleFavouriteSpace)(u,this),e.stopPropagation(),!1})),l.addClass("rw_has_icon_right")):p.remove();n.attr("href",`${e()}/display/${u}`),"true"!==r.excludeDescriptions&&void 0!==t.description&&""!==t.description&&n.append(`<span class="rw_space_description rw_small_text">${i.f.htmlEncode(t.description)}</span>`);"true"===r.showLogo&&void 0!==t.logo?n.prepend(`<span class="rw_item_icon"><img src="${e()}${t.logo}" class="rw_space_logo" /></span>`):void 0!==t.icon?n.prepend(`<span class="rw_item_icon rw_icon rw_iconfont_${t.icon}"></span>`):n.prepend('<span class="rw_item_icon rw_icon rw_iconfont_space"></span>');a.append(o)}(t,a,s,r):"link"===t.type&&function(e,t,a){if(void 0===e)return;const s=c()('<li><a><span class="rw_item_icon rw_icon"></span><span class="rw_item_content"></span></a></li>'),r=c()(".rw_item_icon",s),o=c()(".rw_item_content",s),n=c()("a",s);a%2==0&&s.addClass("rw_alternating");s.attr("id",`rw_link_id_${e.key}`),o.html(i.f.htmlEncode(e.title)),o.attr("title",e.title),void 0!==e.icon?r.addClass(`rw_iconfont_${e.icon}`):r.remove();e.target&&(n.prepend('<span class="rw_item_icon_right rw_icon rw_iconfont_new_window"></span>'),n.attr("target","_blank"),o.addClass("rw_has_icon_right"));n.attr("href",e.url),t.append(s)}(t,a,s)}function I(e,t,a){void 0!==e&&c.a.each(e,(function(e){V(this,t,e,a)}))}function j(e,t,a){const s=h.clone(),r=c()("ul.rw_content_list",s);void 0!==e.children&&c.a.each(e.children,(function(e){V(this,r,e,a)})),t.append(s)}function U(t,a,s,r,i){c()("#rw_spacelist_menu .rw_active",i).removeClass("rw_active"),c()("#rw_spacelist_menu .rw_active_team",i).removeClass("rw_active_team");const n=`spaces-macro.state${i.attr("id")}`,l={spacesSelectedTab:t,selectedCategory:a,selectedTeam:s,spaceDirectoryMode:r};if(o.Storage.setValue(n,JSON.stringify(l)),"team"===t)r?c()(`#rw_spacelist_menu #rw_team_${a}`,i).addClass("rw_active"):(c()("#rw_spacelist_menu #rw_spacelist_team",i).addClass("rw_active"),c()(`#rw_spacelist_menu #rw_team_${a}`,i).addClass("rw_active_team")),""!==a?x(a,c()("#rw_spaces_macro_container",i),i):function(t,a){const s=c()("#rw_spaces_macro_container",a);s.html(y),c.a.ajax({url:`${e()}/rest/refinedtheme/latest/label/space?label=${t}&exclude-archived-spaces=${a.data("excludearchivedspaces")}`,type:"GET",dataType:"json",success(e){s.html(""),j(e,s,C(a))},error(e){k(e,a)}})}(s,i);else if("my"===t)c()("#rw_spacelist_menu #rw_spacelist_my",i).addClass("rw_active"),function(t){const a=c()("#rw_spaces_macro_container",t);a.html(y),c.a.ajax({url:`${e()}/rest/refinedtheme/latest/favourite/spaces?exclude-archived-spaces=${t.data("excludearchivedspaces")}`,type:"GET",dataType:"json",success(e){a.html(""),void 0!==e&&e.length>0?j({children:e},a,C(t)):a.html(w.clone())},error(e){k(e,t)}})}(i);else{c()("#rw_spacelist_menu #rw_spacelist_all",i).addClass("rw_active");const e=i.data("closedcategories");e&&e.trim&&"true"===e.trim()?$(i):T(i)}}function J(e,t,a,s,c){U(e,a,s,c,t)}}.call(this,a(15).default)},911:function(e,t,a){"use strict";if(a.d(t,"e",(function(){return c})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"d",(function(){return n})),window.RW=window.RW||{},void 0===s)var s={};void 0===s.Templates&&(s.Templates={}),void 0===s.Templates.Spaces&&(s.Templates.Spaces={}),s.Templates.Spaces.section=function(e,t){return'<div class="rw_box"><ul class="rw_content_list"></ul></div><div style="clear:both;"></div>'},goog.DEBUG&&(s.Templates.Spaces.section.soyTemplateName="RW.Templates.Spaces.section"),s.Templates.Spaces.categorySection=function(e,t){return'<div class="rw_box"><ul class="rw_content_list"></ul><div style="clear:both"></div><div class="rw_spaces_subcategories"></div></div>'},goog.DEBUG&&(s.Templates.Spaces.categorySection.soyTemplateName="RW.Templates.Spaces.categorySection"),s.Templates.Spaces.categoryItem=function(e,t){var a='<div class="rw_category"><div class="rw_spaces_category_title"><span>'+(e.category&&e.category.name?soy.$$escapeHtml(e.category.name):"")+'</span></div><div class="rw_spaces_category_content" ><ul class="rw_content_list"></ul><div style="clear:both"></div><div class="rw_spaces_subcategories">';if(e.category&&e.category.subCategories)for(var c=e.category.subCategories,r=c.length,i=0;i<r;i++){var o=c[i];a+=s.Templates.Spaces.categoryItem({category:o})}return a+="</div></div></div>"},goog.DEBUG&&(s.Templates.Spaces.categoryItem.soyTemplateName="RW.Templates.Spaces.categoryItem"),s.Templates.Spaces.categoryItemWithDashboard=function(e,t){var a='<div class="rw_category"><a class="rw_item_expand"><span></span></a><div class="rw_spaces_category_title rw_has_expand"><span>'+(e.category&&e.category.name?soy.$$escapeHtml(e.category.name):"")+'</span></div><div class="rw_spaces_category_content" ><ul class="rw_content_list"></ul><div style="clear:both"></div><div class="rw_spaces_subcategories">';if(e.category&&e.category.subCategories)for(var c=e.category.subCategories,r=c.length,i=0;i<r;i++){var o=c[i];a+=s.Templates.Spaces.categoryItem({category:o})}return a+="</div></div></div>"},goog.DEBUG&&(s.Templates.Spaces.categoryItemWithDashboard.soyTemplateName="RW.Templates.Spaces.categoryItemWithDashboard"),s.Templates.Spaces.empty=function(e,t){return'<div class="rw_no_items rw_spaces rw_corners">'+soy.$$escapeHtml("There are no spaces at the moment.")+"</div>"},goog.DEBUG&&(s.Templates.Spaces.empty.soyTemplateName="RW.Templates.Spaces.empty");const c=s.Templates.Spaces.section,r=s.Templates.Spaces.categorySection,i=s.Templates.Spaces.categoryItem,o=s.Templates.Spaces.categoryItemWithDashboard,n=s.Templates.Spaces.empty}}]);
}catch(e){WRMCB(e)};